
> vkart@1.0.0 test
> dotenv -e .env.test -- node --experimental-vm-modules node_modules/jest/bin/jest.js --runInBand --detectOpenHandles --forceExit

  console.warn
    âš  AES_KEY must be 32 bytes for 2FA encryption

    [0m [90m  6 |[39m
     [90m  7 |[39m [36mif[39m ([33m![39m[33mHAS_VALID_KEY[39m) {
    [31m[1m>[22m[39m[90m  8 |[39m     console[33m.[39mwarn([32m'âš  AES_KEY must be 32 bytes for 2FA encryption'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m  9 |[39m }
     [90m 10 |[39m
     [90m 11 |[39m [90m/**[39m[0m

      at utils/crypto.js:8:13

(node:46692) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    Redis Connected Successfully

      at EventEmitter.<anonymous> (utils/redis.js:11:11)

  console.log
    POST /api/register 201 - 387ms

      at ServerResponse.<anonymous> (app.js:33:13)

  console.log
    POST /api/login 200 - 225ms

      at ServerResponse.<anonymous> (app.js:33:13)

  console.log
    POST /api/orders 201 - 51ms

      at ServerResponse.<anonymous> (app.js:33:13)

  console.log
    POST /api/register 201 - 228ms

      at ServerResponse.<anonymous> (app.js:33:13)

  console.log
    POST /api/login 200 - 238ms

      at ServerResponse.<anonymous> (app.js:33:13)

  console.log
    POST /api/orders 401 - 4ms

      at ServerResponse.<anonymous> (app.js:33:13)

FAIL tests/orders.test.js
  Order API
    Ã— should create an order with valid token (828 ms)
    âˆš should reject order without token (535 ms)

  â— Order API â€º should create an order with valid token

    expect(received).toBeUndefined()

    Received: 236

    [0m [90m 59 |[39m         expect(res[33m.[39mstatusCode)[33m.[39mtoEqual([35m201[39m)[33m;[39m
     [90m 60 |[39m         expect(res[33m.[39mbody)[33m.[39mtoHaveProperty([32m'_id'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 61 |[39m         expect(res[33m.[39mbody[33m.[39mtotalPrice)[33m.[39mtoBeUndefined()[33m;[39m [90m// Calculated on frontend usually, or tax+shipping[39m
     [90m    |[39m                                     [31m[1m^[22m[39m
     [90m 62 |[39m     })[33m;[39m
     [90m 63 |[39m
     [90m 64 |[39m     it([32m'should reject order without token'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/orders.test.js:61:37)

  console.warn
    âš  AES_KEY must be 32 bytes for 2FA encryption

    [0m [90m  6 |[39m
     [90m  7 |[39m [36mif[39m ([33m![39m[33mHAS_VALID_KEY[39m) {
    [31m[1m>[22m[39m[90m  8 |[39m     console[33m.[39mwarn([32m'âš  AES_KEY must be 32 bytes for 2FA encryption'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m  9 |[39m }
     [90m 10 |[39m
     [90m 11 |[39m [90m/**[39m[0m

      at utils/crypto.js:8:13

  console.log
    Redis Connected Successfully

      at EventEmitter.<anonymous> (utils/redis.js:11:11)

  console.log
    POST /api/register 201 - 330ms

      at ServerResponse.<anonymous> (app.js:33:13)

  console.log
    POST /api/register 201 - 222ms

      at ServerResponse.<anonymous> (app.js:33:13)

  console.log
    POST /api/login 200 - 217ms

      at ServerResponse.<anonymous> (app.js:33:13)

  console.log
    POST /api/register 201 - 230ms

      at ServerResponse.<anonymous> (app.js:33:13)

  console.log
    POST /api/login 401 - 227ms

      at ServerResponse.<anonymous> (app.js:33:13)

PASS tests/auth.test.js
  Auth Endpoints
    âˆš should register a new user (440 ms)
    âˆš should login with valid credentials (483 ms)
    âˆš should fail login with wrong password (495 ms)

  console.warn
    âš  AES_KEY must be 32 bytes for 2FA encryption

    [0m [90m  6 |[39m
     [90m  7 |[39m [36mif[39m ([33m![39m[33mHAS_VALID_KEY[39m) {
    [31m[1m>[22m[39m[90m  8 |[39m     console[33m.[39mwarn([32m'âš  AES_KEY must be 32 bytes for 2FA encryption'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m  9 |[39m }
     [90m 10 |[39m
     [90m 11 |[39m [90m/**[39m[0m

      at utils/crypto.js:8:13

FAIL tests/products.test.js
  â— Test suite failed to run

    ReferenceError: jest is not defined

    [0m [90m  5 |[39m
     [90m  6 |[39m [90m// Mock Redis to prevent connection errors[39m
    [31m[1m>[22m[39m[90m  7 |[39m jest[33m.[39mmock([32m'../utils/redis.js'[39m[33m,[39m () [33m=>[39m ({
     [90m    |[39m [31m[1m^[22m[39m
     [90m  8 |[39m     [36mget[39m[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m  9 |[39m     [36mset[39m[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 10 |[39m     del[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at tests/products.test.js:7:1

Test Suites: 2 failed, 1 passed, 3 total
Tests:       1 failed, 4 passed, 5 total
Snapshots:   0 total
Time:        9.198 s
Ran all test suites.
